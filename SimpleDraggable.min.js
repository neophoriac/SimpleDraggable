class SimpleDraggable{constructor(t,e,i,s=!1,n=!0){if(!e)throw new Error("dragElement is required!");if(!i)throw new Error("element is required!");if(!(e instanceof HTMLElement))throw new Error("dragElement is not an HTMLElement Object!");if(!(i instanceof HTMLElement))throw new Error("element is not an HTMLElement Object!");if(1!==e.nodeType)throw new Error("dragElement is not an element node!");if(1!==i.nodeType)throw new Error("element is not an element node!");if("string"!=typeof t||""===t)throw new Error("ID is not a string or contains no text!");this.id=t,this.dragElement=e,this.element=i,this.store=s,this.enabled=n,this._boundMouseDown=this._mousedown.bind(this),this._boundDrag=this._drag.bind(this),this._boundStopDrag=this._stopDrag.bind(this),this._boundStorage=this._onStorage.bind(this),this.enabled&&(this._setProperties(),this._restorePos(),this.dragElement.addEventListener("mousedown",this._boundMouseDown)),window.addEventListener("storage",this._boundStorage)}_setProperties(){this.store||localStorage.removeItem(this.id),this.styles=getComputedStyle(this.element),this.position=this.styles.position;if(this.enabled&&"fixed"!==this.position&&"absolute"!==this.position)throw new Error(`Element position cannot be ${this.position}. Use fixed or absolute instead!`);this.elementRect=this.element.getBoundingClientRect(),this.dimensions="fixed"===this.position?this.getViewport():this.getDocDimensions(),this.borderH=parseFloat(this.styles.borderLeft)+parseFloat(this.styles.borderRight),this.borderV=parseFloat(this.styles.borderTop)+parseFloat(this.styles.borderBottom),this.thresholdX=this.dimensions.x-(this.elementRect.width+this.borderH),this.thresholdY=this.dimensions.y-(this.elementRect.height+this.borderV),this.element.dataset.translate='{"x":0,"y":0}',this.pos_1=0,this.pos_2=0,this.pos_3=0,this.pos_4=0,this.translateX=0,this.translateY=0,this.offsetLeft=this.elementRect.left,this.offsetTop=this.elementRect.top}getDocDimensions(){let t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),e=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clientWidth,document.documentElement.clientWidth);return t-=scrollY,e-=scrollX,{y:t,x:e}}getViewport(){return window.visualViewport?{y:visualViewport.height,x:visualViewport.width}:{y:window.innerHeight,x:window.innerWidth}}_mousedown(t){if("false"===this.element.dataset.draggable)return;if(t.target!==this.dragElement)return;if(0!==t.button)return;t.preventDefault(),this.pos_3=t.clientX,this.pos_4=t.clientY,this.elementRect=this.element.getBoundingClientRect();let e={x:0,y:0};try{this.element.dataset.translate&&(e=JSON.parse(this.element.dataset.translate))}catch{}this.translateX=e.x,this.translateY=e.y,this.offsetLeft=this.elementRect.left-this.translateX,this.offsetTop=this.elementRect.top-this.translateY,this.dimensions="fixed"===this.position?this.getViewport():this.getDocDimensions(),this.thresholdX=this.dimensions.x-(this.elementRect.width+this.borderH),this.thresholdY=this.dimensions.y-(this.elementRect.height+this.borderV),window.addEventListener("mousemove",this._boundDrag),window.addEventListener("mouseup",this._boundStopDrag,{once:!0})}_drag(t){this.pos_1=this.pos_3-t.clientX,this.pos_2=this.pos_4-t.clientY,this.pos_3=t.clientX,this.pos_4=t.clientY,this.translateY-=this.pos_2,this.translateX-=this.pos_1;let e=this._getThresholds(this.translateY+this.offsetTop,this.translateX+this.offsetLeft);this.translateY+=e.y,this.translateX+=e.x,this.element.style.translate=`${this.translateX}px ${this.translateY}px`}_stopDrag(){window.removeEventListener("mousemove",this._boundDrag);const t={x:this.translateX,y:this.translateY};this.element.dataset.translate=`{"x":${this.translateX}, "y":${this.translateY}}`,this.store&&localStorage.setItem(this.id,JSON.stringify(t))}_getThresholds(t,e){let i=0,s=0;return this.thresholdX-e<0?i=this.thresholdX-e:e<0&&(i=Math.abs(e)),this.thresholdY-t<0?s=this.thresholdY-t:t<0&&(s=Math.abs(t)),{x:i,y:s}}_getPos(t){let e=t?{y:t.y,x:t.x}:{y:0,x:0};this.elementRect=this.element.getBoundingClientRect(),this.offsetLeft=this.elementRect.left-e.x,this.offsetTop=this.elementRect.top-e.y;let i=this._getThresholds(e.y+this.offsetTop,e.x+this.offsetLeft);return e.y+=i.y,e.x+=i.x,e}_onStorage(t){"false"!==this.element.dataset.draggable&&t.key===this.id&&this._updatePos(t.newValue)}_restorePos(){this._updatePos(localStorage.getItem(this.id))}_updatePos(t){if(!t)return;let e;try{e=JSON.parse(t)}catch{e={x:0,y:0}}const i=this._getPos(e);this.element.dataset.translate=`{"x":${i.x}, "y":${i.y}}`,this.element.style.translate=e?`${i.x}px ${i.y}px`:""}removeListeners(){this.dragElement.removeEventListener("mousedown",this._boundMouseDown),window.removeEventListener("storage",this._boundStorage),window.removeEventListener("mousemove",this._boundDrag),window.removeEventListener("mouseup",this._boundStopDrag,{once:!0})}stop(){this.enabled&&(this.removeListeners(),this.element.dataset.translate='{"x":0,"y":0}',this.enabled=!1)}start(){this.enabled||(this._setProperties(),this._restorePos(),this.dragElement.addEventListener("mousedown",this._boundMouseDown),window.addEventListener("storage",this._boundStorage),this.enabled=!0)}}
